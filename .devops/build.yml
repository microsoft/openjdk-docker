name: "$(Year:yyyy).$(Month).$(BuildID)"

trigger:
  # to make the ci build more efficient
  # https://docs.microsoft.com/en-us/azure/devops/pipelines/repos/azure-repos-git?view=azure-devops&tabs=yaml#batching-ci-runs
  batch: true
  branches:
    include:
      - main
  # for changes in the nightly, pr, release.yml, etc we will ignore them
  # also ignore templates/release.yml since it is not used by ci.yml file
  paths:
    exclude:
      # from .devops folder
      - .devops/build.yml
      # from docker folder
      - docker

pr: none

jobs:  
  - job: build
    displayName: "build "
    pool:
      vmImage: ubuntu-20.04
    strategy:
      matrix:
        cbld:
          distro: cbld
          version: 11
        ubuntu:
          distro: ubuntu
          version: 11
    steps:
      - task: Docker@2
        displayName: build and push image to container registry
        inputs:
          command: buildAndPush
          repository: internal/private/openjdk/jdk
          dockerfile: docker/$(distro)/Dockerfile.msopenjdk-$(version)-jdk
          containerRegistry: "msopenjdk ACR"
          tags: |
            $(version)-$(distro)
